변경 가능성을 최소화하라
==========================
불변 클래스란, 인스턴스의 내부 값을 수정할 수 없는 클래스다.    
불변 인스턴스에 간직된 정보는 고정되어 객체가 파괴되는 순간까지 절대 달라지지 않는다.     
불변 클래스는 가변 클래스보다 설계하고 구현하고 사용하기 쉬우며, 오류가 생길 여지도 적고 훨씬 안전하다.   

* 객체의 상태를 변경하는 메서드를 제공하지 않는다.     
* 클래스를 확장할 수 없도록 한다.
  상속으로 인한 객체 상태 변경도 가능하니까    
* 모든 필드를 final 로 선언하라    
* 모든 필드를 private로 선언하라     
* 자신 외에는 내부의 가변 컴포넌트에 접근할 수 없도록 한다.   

예시 코드가 주어지는데 연산값을 반영하는 것이 아닌 새로운 객체로 만들어 반환한다.   
이처럼 피연산자에 함수를 적용해 그 결과를 반환하지만,   
피연산자 자체는 그대로인 프로그래밍 패턴을 함수형 프로그래밍이라고 한다.   
더불어 메서드 이름도 동사가 아닌 전치사를 사용함으로써 값이 변하지 않는다는 은연의 메시지를 줄 수 있다.   
   
함수형 프로그래밍 방식으로 프로그래밍을 한다면        
코드에서 불변이 되는 영역의 비율이 높아지는 장점을 누릴 수 있다.         
**불변 객체는 단순하다.**      
불변 객체는 생성된 시점의 상태를 파괴될 때까지 그대로 간직한다.      
모든 생성자가 클래스 불변식을 보장한다면       
그 클래스를 사용하는 프로그래머가 다른 노력을 들이지 않더라도 영원히 불변으로 남는다.     
반면 가변 객체는 임의의 복잡한 상태에 놓일 수 있다.     
변경자 메서드가 일으키는 상태 전이를 정밀하게 문서로 남겨놓지 않은 가변 클래스는 믿고 사용하기 어려울 수 있다.     

**불변 객체는 근본적으로 스레드 안전하여 따로 동기화할 필요 없다.**        
여러 스레드가 동시에 사용해도 절대 훼손되지 않는다.         
사실 클래스를 스레드 안전하게 만드느 가장 쉬운 방법이기도 하다.    
불변 객체에 대해서는 그 어떤 스레드도 달느 스레드에 영향을 줄 수 없으니 **불변 객체는 안심하고 공유할 수 있다.**   
따라서 불변 클래스라면 한번 만든 인스턴스를 최대한 재활용하기를 권한다.     
  
가장 쉬운 재활용 방법은 자주 쓰이는 값들을 상수로 제공하거나 캐싱을 하는 것이다.      
캐싱을 한다는 것은 정적 팩터리를 통해 만들 수 있다는 것을 의미하기도 한다.         
이런 정적 팩터리를 만들어두면, 클라이언트를 수정하지 않고도 필요에 따라 캐시 기능을 나중에 덧붙일 수 있다.     
   
불변 객체를 자유롭게 공유할 수 있다는 점은 방어적 복사도 필요 없다는 결론으로 자연스럽게 이어진다.      
아무리 복사해봤자 원본과 똑같으니 복사 자체가 의미가 없다. (clone 제공 안하는게 좋겠져?)  
  
**불변 객체는 자유롭게 공유할 수 잇음은 물론, 불변 객체끼리는 내부 데이터를 공유할 수 있다.**     

**객체를 만들 때 다른 불변 객체들을 구성요소로 사용하면 이점이 많다.**      
값이 바뀌지 않는 구성요소들로 이뤄진 객체라면    
그 구조가 아무리 복잡하더라도 불변식을 유지하기 훨씬 수월하기 때문이다.       
(Map과 Set에서 사용하기 편리하다)  
   
**불변 객체는 그 자체로 실패 원자성을 제공한다.**    
상태가 절대 변하지 않으니 잠깐이라도 불일치 상태에 빠질 가능성이 없다.     

**불변 클래스에도 단점은 있다. 값이 다르면 독립된 다른 객체로 만들어야한다.**       
값의 가지수가 많다면 이들을 모두 만드는데 드는 큰 비용을 처리해야한다.           
이 문제에 대처하는 방법은 흔히 쓰일 다단계 연산들을 예측하여 기본 기능으로 제공하는 방법(StringBuilder, StirngBuffer등)이다.   

클래스가 불변임을 보장하려면 자신을 상속하지 못하게 하기 위해 class에 final을 붙인다.   
더 유연한 방법은 생성자를 private로 선언하고 public 정적 팩터리 메서드를 제공해주는 것이다.   
앞서 언급한대로 캐싱 기능도 곁들일 수 있으며 더불어 메서드도 final 처리해주는 것이 좋다.  

Serializable을 구현하는 불변 클래스의 내부에 가변 객체를 참조하는 필드가 있다면     
readObhect나 readresolve 메서드를 반드시 제공하거나     
ObjectOutputStream.writeUnshared와 ObjectInputStream.readUnshared 메서드를 사용해야한다.     
플랫폼이 제공하는 기본 직렬화 방법이면 충분하다라는 말도 있다.     
그렇지 않으면 공격자가 이 클래스로부터 가변 인스턴스를 만들어낼 수 있다.      

클래스는 꼭 필요한 경우가 아니라면 불변이어야한다.  
그러므로 getter가 있다고 해서 setter를 정의하는 것은 안된다.  
이는 불변 객체가 아니더라도 마찬가지이다. 차라리 의미있는 네이밍의 변경 메서드가 있으면 좋다.    

불변 객체는 다른 합당한 이유가 없다면 모든 필드는 private final이어야한다.    
생성자는 불변식 설정이 모두 완료된 초깃화가 완벽히 끝난 객체를 생성해야한다.      











